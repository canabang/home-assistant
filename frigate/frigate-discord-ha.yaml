alias: ðŸ¤– Frigate â†’ Discord + HA
description: DÃ©tections Frigate avec GenAI, identification auto et horodatage
triggers:
  - topic: frigate/tracked_object_update
    trigger: mqtt
conditions:
  - condition: template
    value_template: |-
      {{ trigger.payload_json.type is defined and 
         trigger.payload_json.type == 'description' }}
actions:
  - action: script.notification_discord
    data:
      nom: "{{ identity }}"
      description: |
        ðŸ“· **CamÃ©ra:** {{ camera }}
        â° **DÃ©tection:** {{ timestamp }}

        **ðŸ¤– Description IA:**
        {{ description }}

        [ðŸ“¹ Voir la vidÃ©o]({{ clip_url }}) â€¢ [ðŸ“Š DÃ©tails]({{ details_url }})
      image_url: "{{ snapshot_url }}"
      images: "{{ snapshot_url }}"
  - action: persistent_notification.create
    data:
      notification_id: frigate_{{ event_id }}
      title: "{{ identity }} - {{ camera }}"
      message: >
        â° **{{ timestamp }}**


        **ðŸ¤– Description IA:**

        {{ description }}


        **Event ID:** {{ event_id }}


        **Liens:**

        [ðŸ“¸ Snapshot]({{ snapshot_url }}) â€¢ [ðŸ“¹ VidÃ©o]({{ clip_url }}) â€¢ [ðŸ“Š
        DÃ©tails]({{ details_url }})
mode: queued
max: 10
variables:
  event_id: "{{ trigger.payload_json.id }}"
  camera: "{{ trigger.payload_json.camera }}"
  description: "{{ trigger.payload_json.description }}"
  identity: >
    {% if 'GaÃ«l' in description %}
      ðŸ  GaÃ«l
    {% elif 'Personne non identifiÃ©e' in description or 'Personne inconnue' in
    description %}
      âš ï¸ Personne inconnue
    {% elif 'Chat' in description or 'chat' in description %}
      ðŸ± Chat
    {% else %}
      ðŸ” DÃ©tection
    {% endif %}
  timestamp: "{{ now().strftime('%d/%m/%y Ã  %Hh%M') }}"
  snapshot_url: https://frigate.canagalactica.ovh/api/events/{{ event_id }}/snapshot.jpg
  clip_url: https://frigate.canagalactica.ovh/api/events/{{ event_id }}/clip.mp4
  details_url: >-
    https://frigate.canagalactica.ovh/events?camera={{ camera }}&id={{ event_id
    }}
