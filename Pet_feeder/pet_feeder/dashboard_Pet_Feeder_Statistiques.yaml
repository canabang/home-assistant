title: üìä Pet Feeder - Statistiques
path: petfeeder-stats
icon: mdi:chart-line
cards: []
type: sections
sections:
  - type: grid
    cards:
      - type: entities
        title: üìä Analytics Long Terme
        entities:
          - type: custom:multiple-entity-row
            entity: sensor.consommation_moyenne_7_jours
            name: Moyennes Historiques
            show_state: false
            entities:
              - entity: sensor.consommation_moyenne_7_jours
                name: 7j
                unit: g
              - entity: sensor.consommation_moyenne_30_jours
                name: 30j
                unit: g
              - entity: input_number.pet_feeder_target_daily_weight
                name: Objectif
                unit: g
          - type: custom:template-entity-row
            entity: sensor.tendance_consommation
            name: Tendance & √âvolution
            icon: mdi:chart-line-variant
            state: "{{ states('sensor.tendance_consommation') }}"
            secondary: >
              {{ state_attr('sensor.tendance_consommation',
              'variation_7j_vs_30j') }} vs moyenne 30j
          - entity: sensor.prediction_autonomie_amelioree
            name: Pr√©diction IA Am√©lior√©e
            icon: mdi:crystal-ball
            secondary_info: >
              {{ state_attr('sensor.prediction_autonomie_amelioree',
              'fiabilite') }} de confiance
          - type: divider
          - entity: sensor.detection_anomalie_alimentaire
            name: D√©tection d'Anomalies
            icon: mdi:magnify-scan
            secondary_info: >
              Confiance: {{ state_attr('sensor.detection_anomalie_alimentaire',
              'niveau_confiance') }}
      - type: custom:mini-graph-card
        name: Historique Consommation (7 jours)
        entities:
          - entity: input_number.pet_feeder_daily_consumption_counter
            name: Consommation r√©elle
            color: "#4caf50"
          - entity: sensor.consommation_moyenne_7_jours
            name: Moyenne mobile 7j
            color: "#2196f3"
            show_line: true
            show_points: false
          - entity: input_number.pet_feeder_target_daily_weight
            name: Objectif
            color: "#ff9800"
            show_line: true
            show_fill: false
        hours_to_show: 168
        group_by: date
        aggregate_func: max
        show:
          labels: true
          legend: true
      - type: entities
        title: üìÖ Rapport Mensuel en Cours
        entities:
          - entity: sensor.stats_mensuelles_pet_feeder
            name: Moyenne du mois
            icon: mdi:calendar-month
            secondary_info: >
              {{ state_attr('sensor.stats_mensuelles_pet_feeder',
              'jours_avec_donnees') }} jours de donn√©es
          - type: custom:template-entity-row
            entity: sensor.stats_mensuelles_pet_feeder
            name: Consommation totale
            icon: mdi:chart-pie
            state: >
              {{ state_attr('sensor.stats_mensuelles_pet_feeder',
              'consommation_totale_mois') }}
            secondary: >
              Projection fin mois: {{
              state_attr('sensor.stats_mensuelles_pet_feeder',
              'projection_mois') }}
          - type: custom:bar-card
            entity: sensor.stats_mensuelles_pet_feeder
            name: Performance vs Objectif
            max: >-
              {{ states('input_number.pet_feeder_target_daily_weight') | float *
              1.2 }}
            positions:
              icon: "off"
              name: inside
            severity:
              - color: "#f44336"
                from: 0
                to: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 0.6 }}
              - color: "#ff9800"
                from: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 0.6 }}
                to: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 0.9 }}
              - color: "#4caf50"
                from: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 0.9 }}
                to: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 1.1 }}
              - color: "#ff9800"
                from: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 1.1 }}
                to: >-
                  {{ states('input_number.pet_feeder_target_daily_weight') |
                  float * 1.2 }}
  - type: grid
    cards:
      - type: entities
        title: üìä Suivi Consommation Avanc√©
        entities:
          - entity: sensor.consommation_moyenne_reelle
            name: Moyenne r√©elle depuis refill
            icon: mdi:chart-line-variant
            secondary_info: |
              {{ state_attr('sensor.consommation_moyenne_reelle', 'methode') }}
          - entity: input_number.pet_feeder_cumulative_distributed_since_refill
            name: Cumul√© depuis refill
            icon: mdi:scale-balance
          - entity: sensor.jours_restants_nourriture_methode_cumulative
            name: Jours restants (m√©thode classique)
            icon: mdi:calendar-clock
            secondary_info: >
              {{
              state_attr('sensor.jours_restants_nourriture_methode_cumulative',
              'precision') }}
          - entity: sensor.prediction_autonomie_amelioree
            name: Pr√©diction IA (avec historique)
            icon: mdi:brain
            secondary_info: >
              {{ state_attr('sensor.prediction_autonomie_amelioree', 'methode')
              }}
          - type: divider
          - type: custom:template-entity-row
            entity: input_number.pet_feeder_refill_date
            name: Date dernier refill
            icon: mdi:calendar-plus
            state: >
              {% set timestamp = states('input_number.pet_feeder_refill_date') |
              float(0) %} {% if timestamp > 0 %}
                {{ timestamp | timestamp_custom('%d/%m/%Y √† %H:%M') }}
              {% else %}
                Non d√©fini
              {% endif %}
            secondary: >
              {% set timestamp = states('input_number.pet_feeder_refill_date') |
              float(0) %} {% if timestamp > 0 %}
                Il y a {{ ((now().timestamp() - timestamp) / 86400) | round(1) }} jours
              {% else %}
                -
              {% endif %}
      - type: entities
        title: üìä Consommation Aujourd'hui vs Historique
        entities:
          - type: custom:multiple-entity-row
            entity: input_number.pet_feeder_daily_consumption_counter
            name: Comparaison Historique
            show_state: false
            entities:
              - entity: input_number.pet_feeder_daily_consumption_counter
                name: Aujourd'hui
                unit: g
              - entity: sensor.consommation_moyenne_7_jours
                name: Moy 7j
                unit: g
              - entity: sensor.consommation_moyenne_30_jours
                name: Moy 30j
                unit: g
          - type: custom:template-entity-row
            entity: sensor.detection_anomalie_alimentaire
            name: Analyse comportementale
            icon: mdi:head-question-outline
            state: "{{ states('sensor.detection_anomalie_alimentaire') }}"
            secondary: >
              {% set ecart = state_attr('sensor.tendance_consommation',
              'ecart_aujourd_hui_vs_moyenne') %}

              √âcart vs moyenne: {{ ecart }}
          - entity: input_number.pet_feeder_total_distributed
            name: Total distribu√© (cumul)
            icon: mdi:counter
      - type: custom:mini-graph-card
        name: Comparaison Pr√©dictions d'Autonomie
        entities:
          - entity: sensor.jours_restants_nourriture_methode_cumulative
            name: M√©thode classique
            color: "#2196f3"
          - entity: sensor.prediction_autonomie_amelioree
            name: Pr√©diction IA
            color: "#ff9800"
        hours_to_show: 168
        line_width: 2
        show:
          graph: line
          labels: true
          legend: true
  - type: grid
    cards:
      - type: conditional
        conditions:
          - entity: sensor.consommation_quotidienne_moyenne
            state_not: "0"
        card:
          type: entities
          title: üìà Statistiques Multi-Temporelles
          entities:
            - type: custom:multiple-entity-row
              entity: sensor.consommation_quotidienne_moyenne
              name: Consommation compar√©e
              show_state: false
              entities:
                - entity: sensor.consommation_quotidienne_moyenne
                  name: Aujourd'hui
                  unit: g
                - entity: sensor.consommation_moyenne_7_jours
                  name: Moy 7j
                  unit: g
                - entity: sensor.consommation_moyenne_30_jours
                  name: Moy 30j
                  unit: g
            - type: custom:multiple-entity-row
              entity: sensor.consommation_moyenne_reelle
              name: Pr√©dictions d'autonomie
              show_state: false
              entities:
                - entity: sensor.jours_restants_nourriture_methode_cumulative
                  name: Classique
                  unit: j
                - entity: sensor.prediction_autonomie_amelioree
                  name: IA
                  unit: j
                - entity: input_number.pet_feeder_target_daily_weight
                  name: Th√©orique
                  unit: j
            - type: custom:bar-card
              entity: sensor.pourcentage_croquette_restant
              name: Niveau du r√©servoir
              positions:
                icon: "off"
                name: inside
              severity:
                - color: "#f44336"
                  from: 0
                  to: 15
                - color: "#ff9800"
                  from: 15
                  to: 30
                - color: "#4caf50"
                  from: 30
                  to: 100
      - type: entities
        title: üéØ Fiabilit√© du Syst√®me
        entities:
          - entity: sensor.validation_stock_multi_sources
            name: Validation Crois√©e
            icon: mdi:check-decagram-outline
            secondary_info: >
              Balance: {{ state_attr('sensor.validation_stock_multi_sources',
              'balance_pourcentage') }} 

              | Estimation: {{
              state_attr('sensor.validation_stock_multi_sources',
              'estimation_pourcentage') }}
          - type: custom:template-entity-row
            entity: sensor.validation_stock_multi_sources
            name: √âcart Sources
            icon: mdi:compare-horizontal
            state: >
              {{ state_attr('sensor.validation_stock_multi_sources',
              'ecart_absolu') }}
            secondary: >
              √âcart relatif: {{
              state_attr('sensor.validation_stock_multi_sources',
              'ecart_relatif') }}
          - entity: sensor.prediction_autonomie_amelioree
            attribute: fiabilite
            name: Confiance Pr√©diction IA
            icon: mdi:brain
          - type: custom:template-entity-row
            entity: sensor.detection_anomalie_alimentaire
            name: Seuils d'Alerte Adaptatifs
            icon: mdi:alert-octagon-outline
            state: >
              {{ state_attr('sensor.detection_anomalie_alimentaire',
              'niveau_confiance') }}
            secondary: >
              Alerte si < {{ state_attr('sensor.detection_anomalie_alimentaire',
              'seuil_alerte_bas') }} 

              ou > {{ state_attr('sensor.detection_anomalie_alimentaire',
              'seuil_alerte_haut') }}
      - type: conditional
        conditions:
          - entity: input_number.pet_feeder_refill_date
            state_not: "0"
        card:
          type: vertical-stack
          cards:
            - type: entities
              title: üìä Comparaison M√©thodes de Calcul
              entities:
                - entity: sensor.jours_restants_nourriture
                  name: üìä Estimation classique
                  icon: mdi:chart-bell-curve
                  secondary_info: |
                    Bas√©e sur consommation th√©orique
                - entity: sensor.jours_restants_nourriture_methode_cumulative
                  name: üéØ Calcul temps r√©el
                  icon: mdi:target
                  secondary_info: >
                    {{
                    state_attr('sensor.jours_restants_nourriture_methode_cumulative',
                    'precision') }}
                - entity: sensor.prediction_autonomie_amelioree
                  name: ü§ñ Pr√©diction IA historique
                  icon: mdi:brain
                  secondary_info: >
                    {{ state_attr('sensor.prediction_autonomie_amelioree',
                    'methode') }}
                - type: custom:template-entity-row
                  entity: sensor.consommation_moyenne_reelle
                  name: Consommation de r√©f√©rence
                  icon: mdi:speedometer
                  state: "{{ states('sensor.consommation_moyenne_reelle') }} g/jour"
                  secondary: >
                    vs {{ states('sensor.consommation_moyenne_7_jours') }}g/jour
                    (historique 7j)
            - type: custom:mini-graph-card
              name: Comparaison Fiabilit√© des Pr√©dictions
              entities:
                - entity: sensor.jours_restants_nourriture_methode_cumulative
                  name: Temps R√©el
                  color: "#2196f3"
                - entity: sensor.prediction_autonomie_amelioree
                  name: IA Pr√©dictive
                  color: "#ff9800"
              hours_to_show: 72
              line_width: 3
              show:
                graph: line
                labels: true
                legend: true
  - type: grid
    cards:
      - type: entities
        title: üíß Analyse Hydratation Avanc√©e
        entities:
          - entity: sensor.hydratation_moyenne_7_jours
            name: Ratio Moyen 7 Jours
            icon: mdi:chart-line
          - entity: sensor.evolution_hydratation
            name: √âvolution Hydratation
            icon: mdi:trending-up
            card_mod:
              style: |
                :host {
                  --paper-item-icon-color: 
                    {% if states('sensor.evolution_hydratation') in ['FORTE_BAISSE', 'FORTE_HAUSSE'] %}
                      red
                    {% elif states('sensor.evolution_hydratation') in ['BAISSE_LEGERE', 'HAUSSE_LEGERE'] %}
                      orange
                    {% else %}
                      green
                    {% endif %} !important;
                }
          - entity: sensor.ratio_hydratation_quotidien
            attribute: conseil_veterinaire
            name: Conseil Sant√©
            icon: mdi:medical-bag
max_columns: 3
